---
redirect_from:
  - "/test-pages/lab06"
interact_link: content/test_pages/lab06.ipynb
kernel_name: dviz
kernel_path: content/test_pages
has_widgets: false
title: |-
  Module 6: Data types and tidy data
pagenum: 6
prev_page:
  url: /test_pages/lab05.html
next_page:
  url: /test_pages/lab07.html
suffix: .ipynb
search: data memory tidy pandas variable income not dataset com column values columns only type types names name series categorical just lets tidyverse tidyr master vignettes take religion specify value dataframe essentially save amount used deep true categories much ordering www non assembled here github pew research melt html well q frequency important represent numpy arrays array fixed length items such integers lot store means sort text objects usage method tells almost need numbers convert dtype faster pewtidydf python youtube watch v module exercise hadley wickham check tree datasets explanation r code small raw githubusercontent csv relationships between center read details

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Module 6: Data types and tidy data</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tidy-data">Tidy data<a class="anchor-link" href="#Tidy-data"> </a></h2><p>Let's do some tidy exercise first. This is one of the non-tidy dataset assembled by Hadley Wickham (check out <a href="https://github.com/tidyverse/tidyr/tree/master/vignettes">here</a> for more datasets, explanation, and R code).</p>
<p>Let's take a look at this small dataset: <a href="https://raw.githubusercontent.com/tidyverse/tidyr/master/vignettes/pew.csv">https://raw.githubusercontent.com/tidyverse/tidyr/master/vignettes/pew.csv</a></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pew_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/tidyverse/tidyr/4c0a8d0fdb9372302fcc57ad995d57a43d9e4337/vignettes/pew.csv&#39;</span><span class="p">)</span>
<span class="n">pew_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>religion</th>
      <th>&lt;$10k</th>
      <th>$10-20k</th>
      <th>$20-30k</th>
      <th>$30-40k</th>
      <th>$40-50k</th>
      <th>$50-75k</th>
      <th>$75-100k</th>
      <th>$100-150k</th>
      <th>&gt;150k</th>
      <th>Don't know/refused</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Agnostic</td>
      <td>27</td>
      <td>34</td>
      <td>60</td>
      <td>81</td>
      <td>76</td>
      <td>137</td>
      <td>122</td>
      <td>109</td>
      <td>84</td>
      <td>96</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Atheist</td>
      <td>12</td>
      <td>27</td>
      <td>37</td>
      <td>52</td>
      <td>35</td>
      <td>70</td>
      <td>73</td>
      <td>59</td>
      <td>74</td>
      <td>76</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Buddhist</td>
      <td>27</td>
      <td>21</td>
      <td>30</td>
      <td>34</td>
      <td>33</td>
      <td>58</td>
      <td>62</td>
      <td>39</td>
      <td>53</td>
      <td>54</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Catholic</td>
      <td>418</td>
      <td>617</td>
      <td>732</td>
      <td>670</td>
      <td>638</td>
      <td>1116</td>
      <td>949</td>
      <td>792</td>
      <td>633</td>
      <td>1489</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Donâ€™t know/refused</td>
      <td>15</td>
      <td>14</td>
      <td>15</td>
      <td>11</td>
      <td>10</td>
      <td>35</td>
      <td>21</td>
      <td>17</td>
      <td>18</td>
      <td>116</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Evangelical Prot</td>
      <td>575</td>
      <td>869</td>
      <td>1064</td>
      <td>982</td>
      <td>881</td>
      <td>1486</td>
      <td>949</td>
      <td>723</td>
      <td>414</td>
      <td>1529</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Hindu</td>
      <td>1</td>
      <td>9</td>
      <td>7</td>
      <td>9</td>
      <td>11</td>
      <td>34</td>
      <td>47</td>
      <td>48</td>
      <td>54</td>
      <td>37</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Historically Black Prot</td>
      <td>228</td>
      <td>244</td>
      <td>236</td>
      <td>238</td>
      <td>197</td>
      <td>223</td>
      <td>131</td>
      <td>81</td>
      <td>78</td>
      <td>339</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Jehovah's Witness</td>
      <td>20</td>
      <td>27</td>
      <td>24</td>
      <td>24</td>
      <td>21</td>
      <td>30</td>
      <td>15</td>
      <td>11</td>
      <td>6</td>
      <td>37</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Jewish</td>
      <td>19</td>
      <td>19</td>
      <td>25</td>
      <td>25</td>
      <td>30</td>
      <td>95</td>
      <td>69</td>
      <td>87</td>
      <td>151</td>
      <td>162</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Mainline Prot</td>
      <td>289</td>
      <td>495</td>
      <td>619</td>
      <td>655</td>
      <td>651</td>
      <td>1107</td>
      <td>939</td>
      <td>753</td>
      <td>634</td>
      <td>1328</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Mormon</td>
      <td>29</td>
      <td>40</td>
      <td>48</td>
      <td>51</td>
      <td>56</td>
      <td>112</td>
      <td>85</td>
      <td>49</td>
      <td>42</td>
      <td>69</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Muslim</td>
      <td>6</td>
      <td>7</td>
      <td>9</td>
      <td>10</td>
      <td>9</td>
      <td>23</td>
      <td>16</td>
      <td>8</td>
      <td>6</td>
      <td>22</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Orthodox</td>
      <td>13</td>
      <td>17</td>
      <td>23</td>
      <td>32</td>
      <td>32</td>
      <td>47</td>
      <td>38</td>
      <td>42</td>
      <td>46</td>
      <td>73</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Other Christian</td>
      <td>9</td>
      <td>7</td>
      <td>11</td>
      <td>13</td>
      <td>13</td>
      <td>14</td>
      <td>18</td>
      <td>14</td>
      <td>12</td>
      <td>18</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Other Faiths</td>
      <td>20</td>
      <td>33</td>
      <td>40</td>
      <td>46</td>
      <td>49</td>
      <td>63</td>
      <td>46</td>
      <td>40</td>
      <td>41</td>
      <td>71</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Other World Religions</td>
      <td>5</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>2</td>
      <td>7</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>8</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Unaffiliated</td>
      <td>217</td>
      <td>299</td>
      <td>374</td>
      <td>365</td>
      <td>341</td>
      <td>528</td>
      <td>407</td>
      <td>321</td>
      <td>258</td>
      <td>597</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This dataset is about the relationships between income and religion, assembled from a research by the Pew Research Center. You can read more details <a href="https://github.com/tidyverse/tidyr/blob/master/vignettes/tidy-data.Rmd#column-headers-are-values-not-variable-names">here</a>. Is this dataset tidy or not? Why?</p>
<p>Yes, many of the columns are values, not variable names. How should we fix it?</p>
<p>Pandas provides a convenient function called <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.melt.html">melt</a>. You specify the <code>id_vars</code> that are variable columns, and <code>value_vars</code> that are value columns, and provide the name for the variable as well as the name for the values.</p>
<p><strong>Q: so please go ahead and tidy it up! I'd suggest to use the variable name "income" and value name "frequency"</strong></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># TODO: put your code here</span>

<span class="n">pew_tidy_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">pew_df</span><span class="p">,</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;religion&#39;</span><span class="p">],</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;income&#39;</span><span class="p">,</span><span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>religion</th>
      <th>income</th>
      <th>frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>80</th>
      <td>Jehovah's Witness</td>
      <td>$40-50k</td>
      <td>21</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Mormon</td>
      <td>$10-20k</td>
      <td>40</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Evangelical Prot</td>
      <td>$20-30k</td>
      <td>1064</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Mainline Prot</td>
      <td>$10-20k</td>
      <td>495</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Catholic</td>
      <td>$10-20k</td>
      <td>617</td>
    </tr>
    <tr>
      <th>111</th>
      <td>Catholic</td>
      <td>$75-100k</td>
      <td>949</td>
    </tr>
    <tr>
      <th>109</th>
      <td>Atheist</td>
      <td>$75-100k</td>
      <td>73</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Jehovah's Witness</td>
      <td>$20-30k</td>
      <td>24</td>
    </tr>
    <tr>
      <th>121</th>
      <td>Orthodox</td>
      <td>$75-100k</td>
      <td>38</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Buddhist</td>
      <td>$20-30k</td>
      <td>30</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you were successful, you'll have something like this:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>religion</th>
      <th>income</th>
      <th>frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>128</th>
      <td>Buddhist</td>
      <td>$100-150k</td>
      <td>39</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Evangelical Prot</td>
      <td>&lt;$10k</td>
      <td>575</td>
    </tr>
    <tr>
      <th>176</th>
      <td>Other Christian</td>
      <td>Don't know/refused</td>
      <td>18</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Mainline Prot</td>
      <td>$30-40k</td>
      <td>655</td>
    </tr>
    <tr>
      <th>72</th>
      <td>Agnostic</td>
      <td>$40-50k</td>
      <td>76</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Mainline Prot</td>
      <td>$10-20k</td>
      <td>495</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Jehovah's Witness</td>
      <td>$20-30k</td>
      <td>24</td>
    </tr>
    <tr>
      <th>110</th>
      <td>Buddhist</td>
      <td>$75-100k</td>
      <td>62</td>
    </tr>
    <tr>
      <th>74</th>
      <td>Buddhist</td>
      <td>$40-50k</td>
      <td>33</td>
    </tr>
    <tr>
      <th>168</th>
      <td>Hindu</td>
      <td>Don't know/refused</td>
      <td>37</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-types">Data types<a class="anchor-link" href="#Data-types"> </a></h2><p>Let's talk about data types briefly. Understanding data types is not only important for choosing the right visualizations, but also important for efficient computing and storage of data. You may not have thought about how pandas represent data in memory. A Pandas <code>Dataframe</code> is essentially a bunch of <code>Series</code>, and those <code>Series</code> are essentially <code>numpy</code> arrays. An array may contain a fixed-length items such as integers or variable length items such as strings. Putting some efforts to think about the correct data type can potentially save a lot of memory as well as time.</p>
<p>A nice example would be the categorical data type. If you have a variable that only has several possible values, it's essentially a categorical data. Take a look at the <code>income</code> variable.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">income</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>$75-100k              18
Don&#39;t know/refused    18
$30-40k               18
&gt;150k                 18
&lt;$10k                 18
$10-20k               18
$50-75k               18
$20-30k               18
$100-150k             18
$40-50k               18
Name: income, dtype: int64</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These were the column names in the original non-tidy data. The value can take only one of these income ranges and thus it is a categorical data. What is the data type that pandas use to store this column?</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">income</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dtype(&#39;O&#39;)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>O</code> means that it is an object data type, which does not have a fixed size like integer or float. The series contains a sort of pointer to the actual text objects. You can actually inspect the amount of memory used by the dataset.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index          80
religion     1440
income       1440
frequency    1440
dtype: int64</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index           80
religion     12780
income       11700
frequency     1440
dtype: int64</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What's going on with the <code>deep=True</code> option? When you don't specify <code>deep=True</code>, the memory usage method just tells you the amount of memory used by the numpy arrays in the pandas dataframe. When you pass <code>deep=True</code>, it tells you the total amount of memory by including the memory used by all the text objects. So, the <code>religion</code> and <code>income</code> columns occupies almost ten times of memory than the <code>frequency</code> column, which is simply an array of integers.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">frequency</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dtype(&#39;int64&#39;)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Is there any way to save up the memory? Note that there are only 10 categories in the income variable. That means we just need 10 numbers to represent the categories! Of course we need to store the names of each category, but that's just one-time cost. The simplest way to convert a column is using <code>astype</code> method.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">income_categorical_series</span> <span class="o">=</span> <span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">income</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="c1"># you can do pew_tidy_df.income = pew_tidy_df.income.astype(&#39;category&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, this series has the <code>CategoricalDtype</code> dtype.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">income_categorical_series</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>CategoricalDtype(categories=[&#39;$10-20k&#39;, &#39;$100-150k&#39;, &#39;$20-30k&#39;, &#39;$30-40k&#39;, &#39;$40-50k&#39;,
                  &#39;$50-75k&#39;, &#39;$75-100k&#39;, &#39;&lt;$10k&#39;, &#39;&gt;150k&#39;,
                  &#39;Don&#39;t know/refused&#39;],
                 ordered=False)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How much memory do we use?</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">income_categorical_series</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1230</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">income</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>11780</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have reduced the memory usage by almost 10 fold! Not only that, because now the values are just numbers, it will be much faster to match, filter, manipulate. If your dataset is huge, this can save up a lot of space and time.</p>
<p>If the categories have ordering, you can specify the ordering too.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.api.types</span> <span class="kn">import</span> <span class="n">CategoricalDtype</span>
<span class="n">income_type</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Don&#39;t know/refused&quot;</span><span class="p">,</span> <span class="s1">&#39;&lt;$10k&#39;</span><span class="p">,</span> <span class="s1">&#39;$10-20k&#39;</span><span class="p">,</span> <span class="s1">&#39;$20-30k&#39;</span><span class="p">,</span> <span class="s1">&#39;$30-40k&#39;</span><span class="p">,</span> 
                                           <span class="s1">&#39;$40-50k&#39;</span><span class="p">,</span> <span class="s1">&#39;$50-75k&#39;</span><span class="p">,</span> <span class="s1">&#39;$75-100k&#39;</span><span class="p">,</span> <span class="s1">&#39;$100-150k&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;150k&#39;</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">income_type</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>CategoricalDtype(categories=[&#39;Don&#39;t know/refused&#39;, &#39;&lt;$10k&#39;, &#39;$10-20k&#39;, &#39;$20-30k&#39;,
                  &#39;$30-40k&#39;, &#39;$40-50k&#39;, &#39;$50-75k&#39;, &#39;$75-100k&#39;, &#39;$100-150k&#39;,
                  &#39;&gt;150k&#39;],
                 ordered=True)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">income</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">income_type</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>CategoricalDtype(categories=[&#39;Don&#39;t know/refused&#39;, &#39;&lt;$10k&#39;, &#39;$10-20k&#39;, &#39;$20-30k&#39;,
                  &#39;$30-40k&#39;, &#39;$40-50k&#39;, &#39;$50-75k&#39;, &#39;$75-100k&#39;, &#39;$100-150k&#39;,
                  &#39;&gt;150k&#39;],
                 ordered=True)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This data type now allows you to compare and sort based on the ordering.</p>
<p><strong>Q: ok, now convert both religion and income columns of <code>pew_tidy_df</code> as categorical dtype (in place) and show that <code>pew_tidy_df</code> now uses much less memory</strong></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># TODO: put your code here</span>
<span class="n">pew_tidy_df</span><span class="p">[</span><span class="s1">&#39;religion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">religion</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">pew_tidy_df</span><span class="p">[</span><span class="s1">&#39;income&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">income</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">pew_tidy_df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index          80
religion     2119
income       1150
frequency    1440
dtype: int64</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="If-you-want-to-know-more">If you want to know more<a class="anchor-link" href="#If-you-want-to-know-more"> </a></h2><ul>
<li><a href="http://www.jeannicholashould.com/tidy-data-in-python.html">Jean-Nicholas Hould: Tidy Data in Python</a></li>
<li><a href="https://www.youtube.com/watch?v=CowlcrtSyME">Stephen Simmons | Pandas from the Inside</a></li>
<li><a href="https://www.youtube.com/watch?v=wDYDYGyN_cw">Data school: How do I make my pandas DataFrame smaller and faster?</a></li>
</ul>

</div>
</div>
</div>
</div>

 


    </main>
    